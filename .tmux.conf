##############################################
# .tmux.conf                                 #
##############################################


###################################
# Basic Environment Configuration #
###################################

# Start window and pane index from 1
set -g base-index 1
setw -g pane-base-index 1

# Set 256 color terminal
#set -g default-terminal "xterm-256color"
set -g default-terminal "screen-256color"

# For pbcopy and pbpaste on OSX
# https://github.com/ChrisJohnsen/tmux-MacOSX-pasteboard
set -g default-command "reattach-to-user-namespace -l zsh"

# Set window notifications
setw -g monitor-activity on
set -g visual-activity on

# Automatically set window title
setw -g automatic-rename on

# Automatically renumber windows
set -g renumber-windows on

# Allow for faster key repetition
set -g repeat-time 0

# Mouse
set -g mouse

# Constrain window size to the max size of any client connected to *that window*
# (as opposed to default: constrain to max size of any client connected to the *session*)
setw -g aggressive-resize on

# Increase history limit
set -g history-limit 50000

# Display tmux messages for 4 seconds
set -g display-time 4000

# emacs key bindings in tmux command prompt are better than vi keys, even for vim users
set -g status-keys emacs

# vi-style controls for copy mode
setw -g mode-keys vi

# No escape time for vi mode
set -sg escape-time 0

# Focus Events enabled for terminals that support them
set -g focus-events on

# Explicitly define shell (shouldn't be necessary as default-command should cover it)
set -g default-shell $SHELL

###################################
# Key Bindings                    #
###################################

# Unbind default stuff I don't use
unbind C-z
unbind C-b
unbind .
unbind D
unbind PPage
unbind '"'
unbind "'"
unbind %
unbind [
unbind n
unbind p
unbind d
unbind C-d
unbind &
unbind i
unbind z
unbind -
unbind '$'
unbind Up
unbind Down
unbind Escape

# Prefix key
set -g prefix C-a
# Ctrl+A to send prefix to a nested tmux/screen session
bind C-a send-prefix

# Exit
bind x kill-pane
bind X confirm-before -p "tmux kill-window #W? (y/n)" kill-window
bind q confirm-before -p "tmux kill-session #S? (y/n)" kill-session
bind Q confirm-before -p "tmux kill-server? This will nuke all running tmux processes! (y/n)" kill-server
bind C-d confirm-before -p "tmux detach-client from current session? (y/n)" detach-client

# Split
bind \ split-window -h -c "#{pane_current_path}"
bind | split-window -fh -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind _ split-window -fv -c "#{pane_current_path}"

# vim copy selection
bind [ copy-mode
bind p paste-buffer

# Copy/Paste like vim Visual mode
bind y run 'tmux save-buffer - | reattach-to-user-namespace pbcopy'
bind C-y run 'tmux save-buffer - | reattach-to-user-namespace pbcopy'

# bind : to command-prompt like vim
# this is the default in tmux already
#bind : command-prompt

# vim key map
bind \; command-prompt

# move around panes with hjkl, as one would in vim after pressing ctrl-w
bind h select-pane -L
bind l select-pane -R
bind j select-pane -D
bind k select-pane -U

# Resize panes with capital vim movement keys, 10 lines at a time
# or lowercase, 5 lines at a time
bind C-H resize-pane -L 5
bind C-L resize-pane -R 5
bind C-J resize-pane -D 5
bind C-K resize-pane -U 5

# Toggle zooming selected pane to fill the window
bind + resize-pane -Z
bind = resize-pane -Z

# Move around between windows and move windows around
bind , previous-window # <
bind C-p previous-window # <
bind . next-window # >
bind C-n next-window # >
bind < swap-window -t :-
bind > swap-window -t :+

# Easily toggle synchronization (mnemonic: e is for echo)
# Sends input to all panes in a given window
# TODO: I should make this a proper toggle at some point
bind e setw synchronize-panes on
bind E setw synchronize-panes off

# Space to jump to last window
bind Space last-window

# Quickly pop a new window and SSH to a host
# TODO: get this working with known_hosts and tab completion?
bind S command-prompt -p ssh: "new-window -n %1 'ssh %1'"

# Reload .tmux.conf
bind r source-file ~/.tmux.conf \; display "tmux config reloaded"

# Refresh client
bind R refresh-client

# Rename windows/sessions
bind n command-prompt "rename-window %%"
bind N command-prompt "rename-session %%"


# Testing
set -g update-environment -r # Added 7.27.15

###################################
# Appearance                      #
###################################

# Copy selection color
setw -g mode-style fg=white,bg=blue

# Alert message line
set -g message-style fg=white,bg=brightblack,bold

# Status line
setw -g window-status-activity-style fg=white,bg=brightblack

# Pane borders
set -g pane-border-style fg=blue,bg=black
set -g pane-active-border-style fg=blue,bg=blue


# Make statusline look rad

tm_tunes="#[fg=white,bg=colour31]#(osascript ~/.dotfiles/bin/tunes.scpt)"


set -g status on
#setw -g utf8 on
#set -g status-utf8 on
set -g status-interval 5
set -g status-left-length 30
set -g status-left "#[fg=colour16,bg=colour254,bold] üí¢  #S #[fg=colour254,bg=brightblack,nobold]ÓÇ∞‚´∏ "
set -g status-right "#{prefix_highlight}#[fg=colour31,bg=brightblack,nobold]ÓÇ≤#[fg=white,bg=colour31] "$tm_tunes"#[fg=white,nobold] #{online_status} #[fg=brightwhite,bg=colour31,nobold] ‚£ø #[fg=white,nobold]%b %d#[fg=white,bg=colour31,nobold] ‚£ø #[fg=white,bright]%R ‚°á"
#set -g status-right "#{prefix_highlight}#[fg=colour31,bg=brightblack,nobold]ÓÇ≤#[fg=white,bg=colour31] "$tm_tunes"#[fg=white,nobold]#{online_status}  #[fg=brightwhite,bg=colour31,nobold] ‚ù∞ #[fg=white,nobold]#h#[fg=brightwhite,bg=colour31,nobold] ‚ù∞ #[fg=white,nobold]%b %d#[fg=white,bg=colour31,nobold] ‚£ø #[fg=white,bright]%R ‚°á"
set -g @online_icon "ÔíÑ"
set -g @offline_icon "Ôñ¨"


set -g status-right-length 150
set -g window-status-format "#[fg=colour249,bg=brightblack]#I#[fg=colour244]‚ùØ#[fg=colour249]#W"
set -g window-status-current-format '#[fg=brightblack,bg=colour31]ÓÇ∞ #[fg=colour117,bg=colour31,noreverse,bold]#I‚ù± #[fg=colour231,bold]#W #[fg=colour31,bg=brightblack,nobold]ÓÇ∞'

# Window Titling
set -g set-titles on
set -g set-titles-string '[#I] #W'

# --- colors (solarized dark)
# default statusbar colors
set -g status-bg brightblack
set -g status-fg yellow
#set -g status-attr default
# default window title colors
setw -g window-status-style fg=brightblue
# active window title colors
setw -g window-status-current-style fg=yellow,bg=brightblack
# pane number display
set -g display-panes-active-colour yellow
set -g display-panes-colour brightblue
# clock
setw -g clock-mode-colour yellow
# --- end colors

#tm_separator_left_bold="‚óÄ"
#tm_separator_left_thin="‚ùÆ"
#tm_separator_right_bold="‚ñ∂"
#tm_separator_right_thin="‚ùØ"
# ‚ù± ‚ùØ ‚´∏
# ‚ù¨ ‚ùÆ ‚ù∞


# TPM - tmux plugin manager 
# Clone into ~/.tmux/plugins/tpm
# `mkdir -p ~/.tmux/plugins/tpm && git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm`
# TODO: Symlink that dir to dotfiles and setup submodules for plugin repos

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
set -g @plugin 'tmux-plugins/tmux-open'
set -g @plugin 'tmux-plugins/tmux-online-status'
set -g @plugin 'tmux-plugins/tmux-resurrect'

# Other examples:
# set -g @plugin 'github_username/plugin_name'
# set -g @plugin 'git@github.com/user/plugin'
# set -g @plugin 'git@bitbucket.com/user/plugin'

# Plugin options

# tmux-prefix-highlight
set -g @prefix_highlight_fg 'white'
set -g @prefix_highlight_bg 'red'
set -g @prefix_highlight_show_copy_mode 'on'
set -g @prefix_highlight_copy_mode_attr 'fg=black,bg=green,bold'
set -g @prefix_highlight_output_prefix ' '
set -g @prefix_highlight_output_suffix '  '

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
